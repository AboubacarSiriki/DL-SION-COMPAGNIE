{% extends "base.html"%}
{% block centre%}
<div class="home-content">
        <div class="overview-boxes">
          <div class="box">
            <div class="right-side">
              <div class="box-topic">Total Produit</div>
              <div class="number">60</div>
              <div class="indicator">
                <i class="bx bx-up-arrow-alt"></i>
                <span class="text">Aujourd'hui</span>
              </div>
            </div>
            <i class="bx bx-cart-alt cart"></i>
          </div>
          <div class="box">
            <div class="right-side">
              <div class="box-topic">Total vente</div>
              <div class="number">50</div>
              <div class="indicator">
                <i class="bx bx-up-arrow-alt"></i>
                <span class="text">Aujourd'hui</span>
              </div>
            </div>
            <i class="bx bxs-cart-add cart two"></i>
          </div>
          <div class="box">
            <div class="right-side">
              <div class="box-topic">Cout total</div>
              <div class="number">11</div>
              <div class="indicator">
                <i class="bx bx-down-arrow-alt down"></i>
                <span class="text">Hier</span>
              </div>
            </div>
            <i class="bx bxs-cart-download cart four"></i>
          </div>
        </div>

        <div class="sales-boxes">
          <div class="recent-sales box">
            <div class="title">
              <p>Liste des commandes</p><button id="open-popup">Passer une commande</button>
            </div>
            <div class="sales-details">
              <ul class="details">
                <li class="topic">Date</li>
                {% for row in resultat %}
                  <li><a href="#">{{ row[0] }}</a></li>
                  {% endfor %}
              </ul>
              <ul class="details">
                <li class="topic">statut</li>
                {% for row in resultat %}
                  <li><a href="#">{{ row[1] }}</a></li>
                  {% endfor %}
              </ul>
              <ul class="details">
                <li class="topic">details</li>
                  {% for row in resultat%}
                   <li><button class="gauche" id="voir"><a href="#"><i class='bx bx-show eyes-icon' style='font-size: 22px; color:white;'></i></a></button></li>
                   {% endfor %}
              </ul>
              <ul class="details">
                <li class="topic">Fournisseur</li>
                {% for row in resultat %}
                  <li><a href="#">{{ row[2] }}</a></li>
                  {% endfor %}
              </ul>
              <ul class="details">
                <li class="topic">Action</li>
                  {% for row in resultat %}
                    <div class="icon">
                      <i class='bx bx-edit edit-icon' style='font-size: 30px; color: blue;'></i>
                      <i class='bx bx-trash delete-icon' style='font-size: 30px; color: red;'></i>
                    </div>
                  {% endfor %}
              </ul>
            </div>
            <div class="button">
              <a href="#">Voir plus</a>
            </div>
          </div>
          <div class="top-sales box">
            <div class="title">Meilleurs Ventes</div>
            <ul class="top-sales-details">
              <li>
                <a href="#">
                  <img src="{{ url_for('static', filename='image/sunglasses.jpg') }}" alt="" />
                  <span class="product"> HP</span>
                </a>
                <span class="price">50.000F</span>
              </li>
              <li>
                <a href="#">
                  <img src="{{ url_for('static', filename='image/jeans.jpg') }}" alt="" />
                  <span class="product">Imprimante </span>
                </a>
                <span class="price">300.000F</span>
              </li>
              <li>
                <a href="#">
                  <img src="{{ url_for('static', filename='image/nike-min.jpg') }}" alt="" />
                  <span class="product">Tablette</span>
                </a>
                <span class="price">400.000F</span>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div id="popup" class="popup">
        <div class="popup-content">
            <span class="close" id="close-popup">&times;</span>
          <h2>Ajout d'une nouvelle commande</h2><br>

            <form id="stock-form" method="post" action="{{url_for('achats')}}">

                 <label for="fournisseur">Fournisseur</label>
                  <select id="fournisseur" name="fournisseur" required>
                      <option value="">Sélectionnez un fournisseur</option>
                      {% for fournisseur in fournisseurs %}
                        <option value="{{fournisseur[0] }}">{{ fournisseur[1] }}</option>
                    {% endfor %}
                      <!-- Ajoutez d'autres options selon vos besoins -->
                  </select>

                  <label for="produit">Produit</label>
                  <select id="produit" name="produit" required>
                      <option value="">Sélectionnez un produit</option>
                      {% for produit in produits %}
                        <option value="{{ produit[0] }}">{{ produit[1] }}</option>
                    {% endfor %}
                      <!-- Ajoutez d'autres options selon vos besoins -->
                  </select>
                <label for="statut">Statut</label>
                  <select id="statut" name="statut" required>
                        <option >selectionner un statut</option>
                        <option >En cours</option>
                        <option >Livré</option>
                        <option >Annuler</option>
                      <!-- Ajoutez d'autres options selon vos besoins -->
                  </select>
                  <label for="nombre">Nombre</label>
                  <input type="number" id="nombre" name="nombre" required>

                  <button type="#" id="add-button">Ajouter</button>

              <table id="stock-table">
                <thead>
                    <tr>
                        <td>Id</td>
                        <td>Nom</td>
                        <td>Quantité</td>
                        <td>Prix</td>
                        <td>Catégorie</td>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>

            <div><button class="btn12"><a href="{{url_for('achats')}}">Retour</a></button>
                <button type="submit">Valider</button>
            </div>
            </form>
        </div>
      </div>
    </div>
</div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var addButton = document.querySelector('#add-button');
            var stockTable = document.querySelector('#stock-table tbody');

            addButton.addEventListener('click', function(event) {
                event.preventDefault();

                var produitId = document.querySelector('#produit').value;
                var nombre = document.querySelector('#nombre').value;

                fetch('/get_product_info/' + produitId)
                    .then(response => response.json())
                    .then(data => {
                        var newRow = document.createElement('tr');
                        newRow.innerHTML = '<td>' + produitId + '</td>' +
                                            '<td>' + data.nom + '</td>' +
                                            '<td>' + nombre + '</td>' +
                                            '<td>' + data.prix + '</td>' +
                                            '<td>' + data.categorie + '</td>';

                        stockTable.appendChild(newRow);
                    })
                    .catch(error => {
                        console.error('Erreur lors de la récupération des informations du produit :', error);
                    });
            });
        });
    </script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var submitButton = document.querySelector('#submit-button');
    var stockTable = document.querySelector('#stock-table tbody');

    submitButton.addEventListener('click', function(event) {
        event.preventDefault();

        // Parcourir toutes les lignes du tableau
        var rows = stockTable.querySelectorAll('tr');
        rows.forEach(function(row) {
            // Récupérer les valeurs des cellules de la ligne
            var produitId = row.querySelector('.produit-id').textContent;
            var nom = row.querySelector('.nom').textContent;
            var quantite = row.querySelector('.quantite').textContent;
            var prix = row.querySelector('.prix').textContent;
            var categorie = row.querySelector('.categorie').textContent;

            // Créer un formulaire pour envoyer les données
            var form = new FormData();
            form.append('produitId', produitId);
            form.append('nom', nom);
            form.append('quantite', quantite);
            form.append('prix', prix);
            form.append('categorie', categorie);

            // Enregistrer les valeurs dans la base de données via une requête AJAX
            fetch('/achats', {
                method: 'POST',
                body: form
            })
            .then(response => {
                if (response.ok) {
                    console.log('Ligne enregistrée avec succès dans la base de données');
                } else {
                    console.error('Erreur lors de l\'enregistrement de la ligne dans la base de données');
                }
            })
            .catch(error => {
                console.error('Erreur lors de l\'enregistrement de la ligne dans la base de données :', error);
            });
        });
    });
});

</script>

{% endblock %}